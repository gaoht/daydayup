# 后端midway
https://github.com/midwayjs/midway
# 前端umi
https://umijs.org/docs/guides/getting-started

# 初始化流程
1. 依赖nodejs 18
```bash
# 初始化midway
tnpm init @ali/midway
# 选择aone应用

# 安装nvm （nodejs管理工具）
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
nvm -v
0.39.1

# 安装node
nvm install 18
nvm use 18
node -v

# 创建前端项目
npx create-umi@latest
```

# 前后一体化
## 修改前端打包路径 
1. umi的配置文件.umirc.ts
```js
{
  outputPath:  '../server/src/public'
}
```
2. 后端static文件设置
staticFile组件
修改configuration.ts
```ts
@Configuration({
  imports: [egg, otel, bucLogin, acl, baseMiddleware, staticFile],
  importConfigs: [join(__dirname, "./config")],
})
```

修改config.ts
```ts
{
    staticFile: {
      dirs: {
        default: {
          prefix: '/',
          dir: 'src/public',
          alias: {
            '/': '/index.html',
          },
        },
      }
    },
}
```

3. 设置启动脚本
package.json
```json
{
    "scripts": {
        "client-install": "cd client && tnpm install --no-package-lock",
        "server-install": "cd server && tnpm install --no-package-lock",
        "postinstall": "tnpm run client-install && tnpm run server-install",
        "start": "cd server && npm run dev",
        "client-start": "cd client && npm run start",
        "build": "npm run postinstall && npm run client-build && npm run server-build",
        "server-build": "cd server && npm run own-build",
        "client-build": "cd client && npm run build",
        "client-lint": "cd client && npm run lint",
        "server-lint": "cd server && npm run lint",
        "lint": "npm run client-lint && npm run server-lint"
  }
}
```

server/package.json
```json
{
    "scripts": {
        "dev": "cross-env ets && cross-env NODE_ENV=local midway-bin dev --ts",
        "client-start": "cd .. && npm run client-start",
        "test": "midway-bin test --ts",
        "cov": "midway-bin cov --ts",
        "lint": "mwts check",
        "lint:fix": "mwts fix",
        "ci": "npm run cov",
        "build": "cd .. && npm run build",
        "own-build": "midway-bin build -c"
    }
}
```

3. 设置本地开发，asset静态服务
```js
{
    assets: {
        publicPath: '/public',
        devServer: {
            port: 8000,
            command: 'npm run client-start',
            debug: true,
            env: {
                APP_ROOT: path.join(__dirname, '../../../client'),
                BROWSER: 'none',
                SOCKET_SERVER: 'http://0.0.0.0:8000',
            },
        },
    }
}
```